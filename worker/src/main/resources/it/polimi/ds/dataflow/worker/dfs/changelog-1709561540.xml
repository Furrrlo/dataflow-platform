<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:comment="http://www.w3.org/1999/xhtml"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd"
        comment:__objectQuotingStrategyComment="
            Needed for jOOQ generator to work properly, otherwise because of its use of H2 internally, names are messed up
            See https://github.com/liquibase/liquibase/issues/2385#issuecomment-1061144420
            See https://github.com/jOOQ/jOOQ/issues/12698"
        objectQuotingStrategy="QUOTE_ALL_OBJECTS">

    <changeSet id="1709561540" author="Ferlo">
        <createTable tableName="dataflow_jobs">
            <column name="worker" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="jobId" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="partition" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="nextBatchPtr" type="int">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <createIndex tableName="dataflow_jobs" indexName="unique_idx_dataflow_jobs" unique="true">
            <column name="worker"/>
            <column name="jobId"/>
            <column name="partition"/>
        </createIndex>

        <addUniqueConstraint tableName="dataflow_jobs"
                             constraintName="unique_cnstr_dataflow_jobs"
                             columnNames="worker,jobId,partition"/>
    </changeSet>
</databaseChangeLog>